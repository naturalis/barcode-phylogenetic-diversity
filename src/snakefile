# Snakefile for running the pipeline.
# Needs dada2 and visualization implementation.
# To use other tools, adjust tools.txt and add them to parameters.py for proper parameter setting of said tools.
# Then add rules to this file.


rule all:
    input:
#        '../results/div-metrics/phylogeny.nwk',
#        '../results/galaxy-ids/rarefy_out.txt',
#        '../results/div-metrics/beta_div_out.txt',
#        '../results/galaxy-ids/export_out.txt',
#        '../results/galaxy-ids/export_alpha_out.txt',
#        '../results/galaxy-ids/export_beta_out.txt',
#        '../results/galaxy-ids/alpha_div_out.txt',
#        '../results/galaxy-ids/export_alpha_out.txt',
#        '../results/div-metrics/alpha_diversity.tsv',
#        '../results/div-metrics/beta_diversity.tsv',
        '../results/div-metrics/alpha_heatmap.png',
        '../results/div-metrics/beta_dendro.png',
        '../results/div-metrics/beta_pcoa.png'

rule paste_data:
	input:
		'../data/sequences.fasta'
	output:
		temp('../results/galaxy-ids/paste_out.txt')
	log:
	    '../results/logs/paste.log'
	script:
		'../bin/galaxy_paste.py'

#rule get_tool_names:
#    input:
#        'tools.txt'
#    output:
#        temp('../results/galaxy-ids/import_tool.txt'),
#        temp('../results/galaxy-ids/dada2_tool.txt'),
#        temp('../results/galaxy-ids/mafft-raxml_tool.txt'),
#        temp('../results/galaxy-ids/rarefy_tool.txt'),
#        temp('../results/galaxy-ids/alpha-phylogenetic_tool.txt'),
#        temp('../results/galaxy-ids/beta-phylogenetic_tool.txt'),
#        temp('../results/galaxy-ids/export_tool.txt')
#    log:
#        '../results/logs/get_tool_names.log'
#    script:
#        '../bin/get_tool_names.py'

rule qiime2_import:
    input:
        '../results/galaxy-ids/import_tool.txt',
        '../results/galaxy-ids/paste_out.txt'
    output:
        temp('../results/galaxy-ids/import_out.txt')
    log:
        '../results/logs/import.log'
    script:
        '../bin/run_tools.py'

#rule mafft_raxml:
#    input:
#        '../results/galaxy-ids/mafft-raxml_tool.txt',
#        '../results/galaxy-ids/import_out.txt'
#    output:
#        temp('../results/galaxy-ids/mafft-raxml_out.txt'),
#        temp('../results/galaxy-ids/mafft-raxml_out2.txt'),
#        temp('../results/galaxy-ids/mafft-raxml_out3.txt'),
#        temp('../results/galaxy-ids/mafft-raxml_out4.txt')
#    log:
#        '../results/logs/mafft-raxml.log'
#    script:
#        '../bin/run_tools.py'

#rule rarefy:
#    input:
#        '../results/galaxy-ids/rarefy_tool.txt',
#        '../results/galaxy-ids/dada2_out.txt'
#    output:
#        temp('../results/galaxy-ids/rarefy_out.txt')
#    log:
#        '../results/logs/rarefy.log'
#    script:
#        '../bin/run_tools.py'

#rule alpha_div:
#    input:
#        '../results/galaxy-ids/alpha-phylogenetic_tool.txt',
#        '../results/galaxy-ids/rarefy_out.txt',
#        '../results/galaxy-ids/mafft-raxml_out4.txt'
#    output:
#        temp('../results/galaxy-ids/alpha_div_out.txt')
#    log:
#        '../results/logs/alpha_div.log'
#    script:
#        '../bin/run_tools.py'

#rule beta_div:
#    input:
#        '../results/galaxy-ids/beta-phylogenetic_tool.txt',
#        '../results/galaxy-ids/rarefy_out.txt',
#        '../results/galaxy-ids/mafft-raxml_out4.txt'
#    output:
#        temp('../results/galaxy-ids/beta_div_out.txt')
#    log:
#        '../results/logs/beta_div.log'
#    script:
#        '../bin/run_tools.py'

#rule qiime2_export_alpha:
#    input:
#        '../results/galaxy-ids/export_tool.txt',
#        '../results/galaxy-ids/alpha_div_out.txt'
#    output:
#        '../results/galaxy-ids/export_alpha_out.txt'
#    log:
#        '../results/logs/export_alpha.log'
#    script:
#        '../bin/run_tools.py'

#rule qiime2_export_beta:
#    input:
#        '../results/galaxy-ids/export_tool.txt',
#        '../results/galaxy-ids/beta_div_out.txt'
#    output:
#        temp('../results/galaxy-ids/export_beta_out.txt')
#    log:
#        '../results/logs/export_beta.log'
#    script:
#        '../bin/run_tools.py'

#rule extract_data:
#    input:
#        '../results/galaxy-ids/export_alpha_out.txt',
#        '../results/galaxy-ids/export_beta_out.txt'
#    output:
#        '../results/div-metrics/alpha_diversity.tsv',
#        '../results/div-metrics/beta_diversity.tsv'
#    log:
#        '../results/logs/extract.log'
#    script:
#        '../bin/galaxy_extract.py'

rule visualize:
    input:
        '../data/sample-metadata.tsv',
        '../results/div-metrics/alpha_diversity.tsv',
        '../results/div-metrics/beta_diversity.tsv'
    output:
        '../results/div-metrics/alpha_heatmap.png',
        '../results/div-metrics/beta_dendro.png',
        '../results/div-metrics/beta_pcoa.png'
    log:
        '../results/logs/visualize.log'
    script:
        '../bin/visualize.py'